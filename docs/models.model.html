---

title: Models


keywords: fastai
sidebar: home_sidebar

summary: "Deep Learning modules with Fastai/Pytorch."
description: "Deep Learning modules with Fastai/Pytorch."
nb_path: "nbs/06_models.model.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/06_models.model.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="seed_everything" class="doc_header"><code>seed_everything</code><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/steel_segmentation/models/model.py#L35" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>seed_everything</code>(<strong><code>seed</code></strong>=<em><code>69</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First we create a classification model to get an encoder that know how to classify defects pixels.
Then, we build a UNet from the trained encoder and train a segmentation model.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">models_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;models&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the Paperspace Gradient machine I stored these models:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">print_competition_data</span><span class="p">(</span><span class="n">models_dir</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">FileNotFoundError</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-5-2f07bcf429a2&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-fg"># missing</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>print_competition_data<span class="ansi-blue-fg">(</span>models_dir<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/Sviluppatore/GitHub/steel_segmentation/steel_segmentation/core.py</span> in <span class="ansi-cyan-fg">print_competition_data</span><span class="ansi-blue-fg">(p)</span>
<span class="ansi-green-intense-fg ansi-bold">     22</span> <span class="ansi-red-fg"># Cell</span>
<span class="ansi-green-intense-fg ansi-bold">     23</span> <span class="ansi-green-fg">def</span> print_competition_data<span class="ansi-blue-fg">(</span>p<span class="ansi-blue-fg">:</span> Path <span class="ansi-blue-fg">=</span> path<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 24</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">for</span> elem <span class="ansi-green-fg">in</span> p<span class="ansi-blue-fg">.</span>ls<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     25</span>         print<span class="ansi-blue-fg">(</span>elem<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     26</span> 

<span class="ansi-green-fg">~/anaconda3/envs/severstal/lib/python3.8/site-packages/fastcore/xtras.py</span> in <span class="ansi-cyan-fg">ls</span><span class="ansi-blue-fg">(self, n_max, file_type, file_exts)</span>
<span class="ansi-green-intense-fg ansi-bold">    117</span>     res <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">(</span>o <span class="ansi-green-fg">for</span> o <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>iterdir<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> has_extns <span class="ansi-green-fg">or</span> o<span class="ansi-blue-fg">.</span>suffix <span class="ansi-green-fg">in</span> extns<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    118</span>     <span class="ansi-green-fg">if</span> n_max <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> res <span class="ansi-blue-fg">=</span> itertools<span class="ansi-blue-fg">.</span>islice<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">,</span> n_max<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 119</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">return</span> L<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    120</span> 
<span class="ansi-green-intense-fg ansi-bold">    121</span> <span class="ansi-red-fg"># Cell</span>

<span class="ansi-green-fg">~/anaconda3/envs/severstal/lib/python3.8/site-packages/fastcore/foundation.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(cls, x, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    120</span>     <span class="ansi-green-fg">def</span> __call__<span class="ansi-blue-fg">(</span>cls<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    121</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> args <span class="ansi-green-fg">and</span> <span class="ansi-green-fg">not</span> kwargs <span class="ansi-green-fg">and</span> x <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span> <span class="ansi-green-fg">and</span> isinstance<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span>cls<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> x
<span class="ansi-green-fg">--&gt; 122</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>__call__<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    123</span> 
<span class="ansi-green-intense-fg ansi-bold">    124</span> <span class="ansi-red-fg"># Cell</span>

<span class="ansi-green-fg">~/anaconda3/envs/severstal/lib/python3.8/site-packages/fastcore/foundation.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, items, use_list, match, *rest)</span>
<span class="ansi-green-intense-fg ansi-bold">    128</span>     <span class="ansi-green-fg">def</span> __init__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> items<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>rest<span class="ansi-blue-fg">,</span> use_list<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">,</span> match<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    129</span>         <span class="ansi-green-fg">if</span> <span class="ansi-blue-fg">(</span>use_list <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">or</span> <span class="ansi-green-fg">not</span> is_array<span class="ansi-blue-fg">(</span>items<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 130</span><span class="ansi-red-fg">             </span>items <span class="ansi-blue-fg">=</span> listify<span class="ansi-blue-fg">(</span>items<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>rest<span class="ansi-blue-fg">,</span> use_list<span class="ansi-blue-fg">=</span>use_list<span class="ansi-blue-fg">,</span> match<span class="ansi-blue-fg">=</span>match<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    131</span>         super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>__init__<span class="ansi-blue-fg">(</span>items<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    132</span> 

<span class="ansi-green-fg">~/anaconda3/envs/severstal/lib/python3.8/site-packages/fastcore/basics.py</span> in <span class="ansi-cyan-fg">listify</span><span class="ansi-blue-fg">(o, use_list, match, *rest)</span>
<span class="ansi-green-intense-fg ansi-bold">     53</span>     <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>o<span class="ansi-blue-fg">,</span> list<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> res <span class="ansi-blue-fg">=</span> o
<span class="ansi-green-intense-fg ansi-bold">     54</span>     <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>o<span class="ansi-blue-fg">,</span> str<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">or</span> is_array<span class="ansi-blue-fg">(</span>o<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> res <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>o<span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">---&gt; 55</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">elif</span> is_iter<span class="ansi-blue-fg">(</span>o<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> res <span class="ansi-blue-fg">=</span> list<span class="ansi-blue-fg">(</span>o<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     56</span>     <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span> res <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>o<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     57</span>     <span class="ansi-green-fg">if</span> match <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/envs/severstal/lib/python3.8/site-packages/fastcore/xtras.py</span> in <span class="ansi-cyan-fg">&lt;genexpr&gt;</span><span class="ansi-blue-fg">(.0)</span>
<span class="ansi-green-intense-fg ansi-bold">    115</span>     <span class="ansi-green-fg">if</span> file_type<span class="ansi-blue-fg">:</span> extns <span class="ansi-blue-fg">+=</span> L<span class="ansi-blue-fg">(</span>k <span class="ansi-green-fg">for</span> k<span class="ansi-blue-fg">,</span>v <span class="ansi-green-fg">in</span> mimetypes<span class="ansi-blue-fg">.</span>types_map<span class="ansi-blue-fg">.</span>items<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> v<span class="ansi-blue-fg">.</span>startswith<span class="ansi-blue-fg">(</span>file_type<span class="ansi-blue-fg">+</span><span class="ansi-blue-fg">&#39;/&#39;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    116</span>     has_extns <span class="ansi-blue-fg">=</span> len<span class="ansi-blue-fg">(</span>extns<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">==</span><span class="ansi-cyan-fg">0</span>
<span class="ansi-green-fg">--&gt; 117</span><span class="ansi-red-fg">     </span>res <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">(</span>o <span class="ansi-green-fg">for</span> o <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>iterdir<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> has_extns <span class="ansi-green-fg">or</span> o<span class="ansi-blue-fg">.</span>suffix <span class="ansi-green-fg">in</span> extns<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    118</span>     <span class="ansi-green-fg">if</span> n_max <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> res <span class="ansi-blue-fg">=</span> itertools<span class="ansi-blue-fg">.</span>islice<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">,</span> n_max<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    119</span>     <span class="ansi-green-fg">return</span> L<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/anaconda3/envs/severstal/lib/python3.8/pathlib.py</span> in <span class="ansi-cyan-fg">iterdir</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">   1116</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_closed<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1117</span>             self<span class="ansi-blue-fg">.</span>_raise_closed<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">-&gt; 1118</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">for</span> name <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>_accessor<span class="ansi-blue-fg">.</span>listdir<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1119</span>             <span class="ansi-green-fg">if</span> name <span class="ansi-green-fg">in</span> <span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">&#39;.&#39;</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;..&#39;</span><span class="ansi-blue-fg">}</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1120</span>                 <span class="ansi-red-fg"># Yielding a path object for these makes little sense</span>

<span class="ansi-red-fg">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;../models&#39;</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Classification">Classification<a class="anchor-link" href="#Classification"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">class_metrics</span> <span class="o">=</span> <span class="p">[</span><span class="n">accuracy_multi</span><span class="p">,</span> <span class="n">PrecisionMulti</span><span class="p">(),</span> <span class="n">RecallMulti</span><span class="p">()]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These lines of code allow me to create a classification <code>Learner</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bs</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">dls</span> <span class="o">=</span> <span class="n">get_classification_dls</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
<span class="n">arch</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">resnet18</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">class_learner</span> <span class="o">=</span> <span class="n">cnn_learner</span><span class="p">(</span>
    <span class="n">dls</span><span class="o">=</span><span class="n">dls</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="n">arch</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">class_metrics</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Segmentation">Segmentation<a class="anchor-link" href="#Segmentation"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seg_metrics</span> <span class="o">=</span> <span class="p">[</span><span class="n">ModDiceMulti</span><span class="p">(),</span> <span class="n">dice_kaggle</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These lines of code allow me to create a segmentation <code>Learner</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bs</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">szs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span>

<span class="c1">#dls = get_segmentation_dls_from_df(train_multi, bs, szs)</span>
<span class="n">dls</span> <span class="o">=</span> <span class="n">get_segmentation_dls</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">szs</span><span class="p">)</span>
<span class="n">segmentation_learner</span> <span class="o">=</span> <span class="n">unet_learner</span><span class="p">(</span>
    <span class="n">dls</span><span class="o">=</span><span class="n">dls</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="n">resnet18</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">seg_metrics</span><span class="p">,</span> <span class="n">pretrained</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To load a custom head in a Unet model:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">encoder_path</span> <span class="o">=</span> <span class="n">models_dir</span> <span class="o">/</span> <span class="s2">&quot;ResNet18-2_class.pt&quot;</span>
<span class="n">segmentation_learner</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">encoder_path</span><span class="p">),</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Pytorch-Trainer">Pytorch Trainer<a class="anchor-link" href="#Pytorch-Trainer"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The code in this project is not only FastAi. I based an alternative solution based on this <a href="https://www.kaggle.com/rishabhiitbhu/unet-starter-kernel-pytorch-lb-0-88">kernel</a>. 
In this notebook I will go through each part of the model from that kernel.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">seed_everything</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">smp</span><span class="o">.</span><span class="n">Unet</span><span class="p">(</span><span class="s2">&quot;resnet18&quot;</span><span class="p">,</span> 
                 <span class="n">encoder_weights</span><span class="o">=</span><span class="s2">&quot;imagenet&quot;</span><span class="p">,</span> 
                 <span class="n">classes</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> 
                 <span class="n">activation</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Trainer" class="doc_header"><code>class</code> <code>Trainer</code><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/steel_segmentation/models/model.py#L53" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Trainer</code>(<strong><code>model</code></strong>, <strong><code>save_path</code></strong>, <strong><code>num_epochs</code></strong>=<em><code>20</code></em>, <strong><code>lr</code></strong>=<em><code>0.0005</code></em>, <strong><code>bs</code></strong>=<em><code>16</code></em>, <strong><code>num_workers</code></strong>=<em><code>6</code></em>)</p>
</blockquote>
<p>This class takes care of training and validation of our model</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Trainer.__init__" class="doc_header"><code>Trainer.__init__</code><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/steel_segmentation/models/model.py#L56" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Trainer.__init__</code>(<strong><code>model</code></strong>, <strong><code>save_path</code></strong>, <strong><code>num_epochs</code></strong>=<em><code>20</code></em>, <strong><code>lr</code></strong>=<em><code>0.0005</code></em>, <strong><code>bs</code></strong>=<em><code>16</code></em>, <strong><code>num_workers</code></strong>=<em><code>6</code></em>)</p>
</blockquote>
<p>Initialize self.  See help(type(self)) for accurate signature.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Trainer.forward" class="doc_header"><code>Trainer.forward</code><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/steel_segmentation/models/model.py#L93" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Trainer.forward</code>(<strong><code>images</code></strong>, <strong><code>targets</code></strong>)</p>
</blockquote>
<p>Forward pass:
    load to GPU the imgs and masks,
    calculate predictions,
    calculate loss</p>
<p>Returns:
    loss and predictions</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Trainer.iterate" class="doc_header"><code>Trainer.iterate</code><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/steel_segmentation/models/model.py#L109" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Trainer.iterate</code>(<strong><code>epoch</code></strong>, <strong><code>phase</code></strong>)</p>
</blockquote>
<p>Iterate throught each batch in training or validation phase.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Trainer.start" class="doc_header"><code>Trainer.start</code><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/steel_segmentation/models/model.py#L149" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Trainer.start</code>()</p>
</blockquote>
<p>Training loop for each epochs.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_trainer</span> <span class="o">=</span> <span class="n">Trainer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

