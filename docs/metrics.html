---

title: Metrics


keywords: fastai
sidebar: home_sidebar

summary: "A collection of Metrics used in the segmentation models"
description: "A collection of Metrics used in the segmentation models"
nb_path: "dev_nbs/05_metrics.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: dev_nbs/05_metrics.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Fastai-metrics">Fastai metrics<a class="anchor-link" href="#Fastai-metrics"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Some code from the fastai docs to test properly the metrics:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@delegates</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">TstLearner</span><span class="p">(</span><span class="n">Learner</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dls</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">pred</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">xb</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">yb</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span>
        
<span class="c1">#Go through a fake cycle with various batch sizes and computes the value of met</span>
<span class="k">def</span> <span class="nf">compute_val</span><span class="p">(</span><span class="n">met</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">):</span>
    <span class="n">met</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span>
    <span class="n">learn</span> <span class="o">=</span> <span class="n">TstLearner</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">learn</span><span class="o">.</span><span class="n">pred</span><span class="p">,</span><span class="n">learn</span><span class="o">.</span><span class="n">yb</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span> <span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]],)</span>
        <span class="n">met</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="n">learn</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">met</span><span class="o">.</span><span class="n">value</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ModDiceMulti" class="doc_header"><code>class</code> <code>ModDiceMulti</code><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/steel_segmentation/metrics.py#L20" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ModDiceMulti</code>(<strong><code>axis</code></strong>=<em><code>1</code></em>) :: <code>Metric</code></p>
</blockquote>
<p>Averaged Dice metric (Macro F1) for multiclass target in segmentation</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For test purpose, we create a tensor, <code>x1</code>, as a prediction for the first channel.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x1a</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x1b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">x1a</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
<span class="n">x1c</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">x1a</span><span class="p">)</span><span class="o">*</span><span class="mf">0.3</span>
<span class="n">x1d</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">x1a</span><span class="p">)</span><span class="o">*</span><span class="mf">0.1</span>

<span class="n">x1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">x1a</span><span class="p">,</span><span class="n">x1b</span><span class="p">,</span><span class="n">x1c</span><span class="p">,</span><span class="n">x1d</span><span class="p">),</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># Prediction: 20x4</span>
<span class="n">x1</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([20, 4, 1, 1])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The target is a flatten mask, used by fastai segmentation models.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Target: 20xClass0</span>
<span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">x2</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(tensor([[[0.]],
 
         [[0.]],
 
         [[0.]],
 
         [[0.]],
 
         [[0.]]]),
 torch.Size([20, 1, 1]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dice_obj</span> <span class="o">=</span> <span class="n">DiceMulti</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">compute_val</span><span class="p">(</span><span class="n">dice_obj</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span> <span class="mf">1.</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Target: 20xClass1</span>
<span class="c1"># Dice metric = 0</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">compute_val</span><span class="p">(</span><span class="n">dice_obj</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">),</span> <span class="mf">0.</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x2a</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x2b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x2c</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">x2d</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span>

<span class="n">x2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">x2a</span><span class="p">,</span><span class="n">x2b</span><span class="p">,</span><span class="n">x2c</span><span class="p">,</span><span class="n">x2d</span><span class="p">),</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>   <span class="c1"># Target: 10xClass0, 4xClass1, 3xClass2, 3xClass4</span>
<span class="n">x2</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Size([20, 1, 1])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dice1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">10</span><span class="o">+</span><span class="mi">4</span><span class="o">+</span><span class="mi">3</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>              <span class="c1"># Dice: 2*TP/(2*TP+FP+FN)</span>
<span class="n">dice2</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">dice3</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">dice4</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c1"># Value to be tested</span>
<span class="n">computed_dice</span> <span class="o">=</span> <span class="n">compute_val</span><span class="p">(</span><span class="n">dice_obj</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
<span class="c1"># Dice metric = 0.1666</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">computed_dice</span><span class="p">,</span> <span class="p">(</span><span class="n">dice1</span><span class="o">+</span><span class="n">dice2</span><span class="o">+</span><span class="n">dice3</span><span class="o">+</span><span class="n">dice4</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="p">[</span><span class="n">dice1</span><span class="p">,</span> <span class="n">dice2</span><span class="p">,</span> <span class="n">dice3</span><span class="p">,</span> <span class="n">dice4</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">computed_dice</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[[0.6666666666666666, 0, 0, 0]]
0.16666666666666666
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dice_obj</span><span class="o">.</span><span class="n">inter</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{0: 10.0, 1: 0.0, 2: 0.0, 3: 0.0}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dice_obj</span><span class="o">.</span><span class="n">union</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{0: 30.0, 1: 4.0, 2: 3.0, 3: 3.0}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">binary_dice_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">dice_obj</span><span class="o">.</span><span class="n">inter</span><span class="p">:</span>
    <span class="n">binary_dice_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">binary_dice_scores</span><span class="p">,</span> 
        <span class="mf">2.</span><span class="o">*</span><span class="n">dice_obj</span><span class="o">.</span><span class="n">inter</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">/</span><span class="n">dice_obj</span><span class="o">.</span><span class="n">union</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> 
        <span class="k">if</span> <span class="n">dice_obj</span><span class="o">.</span><span class="n">union</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">binary_dice_scores</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([0.66666667, 0.        , 0.        , 0.        ])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">binary_dice_scores</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.16666666666666666</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="KaggleDice" class="doc_header"><code>class</code> <code>KaggleDice</code><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/steel_segmentation/metrics.py#L56" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>KaggleDice</code>(<strong><code>axis</code></strong>=<em><code>1</code></em>, <strong><code>eps</code></strong>=<em><code>1e-09</code></em>) :: <code>Metric</code></p>
</blockquote>
<p>Blueprint for defining a metric</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dice_kaggle_obj</span> <span class="o">=</span> <span class="n">KaggleDice</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">computed_kaggle_dice</span> <span class="o">=</span> <span class="n">compute_val</span><span class="p">(</span><span class="n">dice_kaggle_obj</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dice_kaggle_obj</span><span class="o">.</span><span class="n">value</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.7500000000777778</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test for <a href="/steel_segmentation/metrics.html#KaggleDice"><code>KaggleDice</code></a>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span>
<span class="n">intersect</span><span class="p">,</span> <span class="n">union</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">x1</span><span class="p">[</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
    <span class="n">targs</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">clone</span><span class="p">(),)</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-9</span>

    <span class="c1">#pred[0]</span>

    <span class="n">n</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">targs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1">#n, c</span>

    <span class="n">pred</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">targs</span> <span class="o">=</span> <span class="n">targs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">#pred.shape, targs.shape</span>

    <span class="c1">#pred[0]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pred</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">targs</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1">#p, t = TensorBase(p), TensorBase(t)</span>
        <span class="n">c_inter</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="c1">#.item()</span>
        <span class="n">c_union</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="c1">#.item()</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">intersect</span><span class="p">:</span>
            <span class="n">intersect</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">intersect</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">c_inter</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">union</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">union</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">c_union</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">intersect</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_inter</span>
            <span class="n">union</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_union</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iter n.</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="se">\n</span><span class="s2">intersect: </span><span class="si">{</span><span class="n">intersect</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">union: </span><span class="si">{</span><span class="n">union</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1">#intersect, union</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Iter n.0
intersect: tensor([1., 1., 1., 1., 1., 1.])
union: tensor([2., 2., 2., 2., 2., 2.])

Iter n.1
intersect: tensor([0., 0., 0., 0., 0., 0.])
union: tensor([0., 0., 0., 0., 0., 0.])

Iter n.2
intersect: tensor([0., 0., 0., 0., 0., 0.])
union: tensor([0., 0., 0., 0., 0., 0.])

Iter n.3
intersect: tensor([0., 0., 0., 0., 0., 0.])
union: tensor([0., 0., 0., 0., 0., 0.])

Iter n.0
intersect: tensor([1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 0., 0., 0.])
union: tensor([2., 2., 2., 2., 2., 2., 2., 2., 2., 2., 1., 1., 1., 1., 1.])

Iter n.1
intersect: tensor([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.])
union: tensor([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 1., 1., 1., 0.])

Iter n.2
intersect: tensor([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.])
union: tensor([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1.])

Iter n.3
intersect: tensor([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.])
union: tensor([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.])

Iter n.0
intersect: tensor([1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 0., 0., 0., 0., 0., 0.,
        0., 0.])
union: tensor([2., 2., 2., 2., 2., 2., 2., 2., 2., 2., 1., 1., 1., 1., 1., 1., 1., 1.,
        1., 1.])

Iter n.1
intersect: tensor([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.])
union: tensor([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 1., 1., 1., 0., 0., 0., 0.,
        0., 0.])

Iter n.2
intersect: tensor([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.])
union: tensor([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1., 1., 1., 0.,
        0., 0.])

Iter n.3
intersect: tensor([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.])
union: tensor([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1.,
        1., 1.])

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">binary_dice_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intersect</span><span class="p">)):</span>
    <span class="n">cond</span> <span class="o">=</span> <span class="n">union</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">val</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">intersect</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">+</span><span class="n">eps</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">union</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">+</span><span class="n">eps</span><span class="p">)</span>
    <span class="n">val</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">binary_dice_scores</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">binary_dice_scores</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binary_dice_scores</span><span class="p">[(</span><span class="n">i</span><span class="o">*</span><span class="mi">20</span><span class="p">):((</span><span class="n">i</span><span class="o">*</span><span class="mi">20</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">)])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_close</span><span class="p">(</span><span class="n">computed_kaggle_dice</span><span class="p">,</span> <span class="n">binary_dice_scores</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dice_kaggle" class="doc_header"><code>dice_kaggle</code><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/steel_segmentation/metrics.py#L93" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dice_kaggle</code>(<strong><code>pred</code></strong>:<code>Tensor</code>, <strong><code>targs</code></strong>:<code>Tensor</code>, <strong><code>iou</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>eps</code></strong>:<code>float</code>=<em><code>1e-08</code></em>)</p>
</blockquote>
<p>The metric of the competition,
if there's no defect in <code>targs</code> and no defects in <code>pred</code>: dice=1.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dice_kag</span> <span class="o">=</span> <span class="n">dice_kaggle</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
<span class="n">dice_kag</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>TensorBase(0.8333)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_ne</span><span class="p">(</span><span class="n">computed_dice</span><span class="p">,</span> <span class="n">dice_kag</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Pure-Pytorch-metrics">Pure Pytorch metrics<a class="anchor-link" href="#Pure-Pytorch-metrics"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compute_ious" class="doc_header"><code>compute_ious</code><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/steel_segmentation/metrics.py#L115" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compute_ious</code>(<strong><code>pred</code></strong>, <strong><code>label</code></strong>, <strong><code>classes</code></strong>, <strong><code>ignore_index</code></strong>=<em><code>255</code></em>, <strong><code>only_present</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>computes IoU for one ground truth mask and predicted mask</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x3</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">x3</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x2</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x3</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor([[[0.]],

        [[0.]],

        [[1.]],

        [[0.]]])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">compute_ious</span><span class="p">(</span><span class="n">x1</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">x3</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[0.0, 0.5, nan, nan]
[0.0, 0.0, nan, nan]
[0.0, 0.0, nan, nan]
[0.0, 0.0, nan, nan]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compute_iou_batch" class="doc_header"><code>compute_iou_batch</code><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/steel_segmentation/metrics.py#L132" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compute_iou_batch</code>(<strong><code>outputs</code></strong>, <strong><code>labels</code></strong>, <strong><code>classes</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>computes mean iou for a batch of ground truth masks and predicted masks</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">compute_iou_batch</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.25</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="metric" class="doc_header"><code>metric</code><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/steel_segmentation/metrics.py#L143" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>metric</code>(<strong><code>probability</code></strong>, <strong><code>truth</code></strong>, <strong><code>threshold</code></strong>=<em><code>0.5</code></em>, <strong><code>reduction</code></strong>=<em><code>'none'</code></em>)</p>
</blockquote>
<p>Calculates dice of positive and negative images seperately
<code>probability</code> and <code>truth</code> must be <code>torch.Tensors</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">metric</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x3</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor(0.5000)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="predict" class="doc_header"><code>predict</code><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/steel_segmentation/metrics.py#L175" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>predict</code>(<strong><code>X</code></strong>, <strong><code>threshold</code></strong>)</p>
</blockquote>
<p>X is sigmoid output of the model</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Meter" class="doc_header"><code>class</code> <code>Meter</code><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/steel_segmentation/metrics.py#L182" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Meter</code>(<strong><code>phase</code></strong>, <strong><code>epoch</code></strong>)</p>
</blockquote>
<p>A meter to keep track of iou and dice scores throughout an epoch</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Meter.get_metrics" class="doc_header"><code>Meter.get_metrics</code><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/steel_segmentation/metrics.py#L204" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Meter.get_metrics</code>()</p>
</blockquote>
<p>Calc the mean of dices metrics (dice, dice_neg, dice_pos)
and IoU mean.</p>
<p>Returns:
    <code>dices</code> as list of means <code>[dice, dice_neg, dice_pos]</code>,
    <code>iou</code> as mean of IoUs</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="epoch_log" class="doc_header"><code>epoch_log</code><a href="https://github.com/marcomatteo/steel_segmentation/tree/master/steel_segmentation/metrics.py#L223" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>epoch_log</code>(<strong><code>phase</code></strong>, <strong><code>epoch</code></strong>, <strong><code>epoch_loss</code></strong>, <strong><code>meter</code></strong>, <strong><code>start</code></strong>)</p>
</blockquote>
<p>logging the metrics at the end of an epoch</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

